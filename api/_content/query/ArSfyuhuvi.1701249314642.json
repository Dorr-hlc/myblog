[{"_path":"/articles/2020-04-01-js","_dir":"articles","_draft":false,"_partial":false,"_locale":"","_empty":false,"title":"异步编程","description":"Javcscript是单线程机制，单线程模型指的是，JavaScript只在一个线程上运行。也就是说，JavaScript 同时只能执行一个任务，其他任务都必须在后面排队等待。JavaScript 之所以采用单线程，而不是多线程，原因是不想让浏览器变得太复杂，因为多线程需要共享资源、且有可能修改彼此的运行结果，对于一种网页脚本语言来说，这就太复杂了。","date":"2020-04-01T00:00:00.000Z","tags":["JavaScript"],"body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Javcscript是单线程机制，单线程模型指的是，JavaScript只在一个线程上运行。也就是说，JavaScript 同时只能执行一个任务，其他任务都必须在后面排队等待。JavaScript 之所以采用单线程，而不是多线程，原因是不想让浏览器变得太复杂，因为多线程需要共享资源、且有可能修改彼此的运行结果，对于一种网页脚本语言来说，这就太复杂了。"}]},{"type":"element","tag":"h2","props":{"id":"异步编程解决了什么问题"},"children":[{"type":"text","value":"异步编程解决了什么问题？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"单线程的好处是实现起来比较简单，执行环境相对单纯；坏处是只要有一个任务耗时很长，后面的任务都必须排队等着，会拖延整个程序的执行。常见的浏览器无响应（假死），往往就是因为某一段JavaScript代码长时间运行（比如死循环），导致整个页面卡在这个地方，其他任务无法执行。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"为了解决JavaScript执行任务只能一个一个排队执行得问题（同步执行）引入了异步编程方案来实现（异步并行执行任务），对于几种常见异步编程方案有："}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"回调函数"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"事件监听"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"发布/订阅"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Promise对象"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Generator/yield（ES6）"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"async/await（ES7）"}]}]},{"type":"element","tag":"h2","props":{"id":"同步和异步任务"},"children":[{"type":"text","value":"同步和异步任务"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"程序里面所有的任务，可以分成两类：同步任务（synchronous）和异步任务（asynchronous）。"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"同步任务"}]},{"type":"text","value":":是指那些没有被引擎挂起、在主线程上排队执行的任务。只有前一个任务执行完毕，才能执行后一个任务。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"异步任务"}]},{"type":"text","value":":是指那些被引擎放在一边，不进入主线程、而进入任务队列的任务。"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"只有引擎认为某个异步任务可以执行了（比如 Ajax 操作从服务器得到了结果），该任务（采用回调函数的形式）才会进入主线程执行。"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"JavaScript"}]},{"type":"text","value":"运行时，除了一个正在运行的主线程，引擎还提供一个任务队列（task queue），里面是各种需要当前程序处理的异步任务。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"异步任务的写法通常是 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"回调函数"}]},{"type":"text","value":"。一旦异步任务重新进入主线程，就会执行对应的回调函数。如果一个异步任务没有回调函数，就不会进入任务队列，也就是说，不会重新进入主线程，因为没有用回调函数指定下一步的操作。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"下面总结一下异步操作的几种模式。"}]}]},{"type":"element","tag":"h2","props":{"id":"_1回调函数"},"children":[{"type":"text","value":"1、回调函数"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"回调函数是异步操作最基本的方法，一般指函数里面嵌套函数来调用其他函数。"}]},{"type":"element","tag":"code","props":{"code":"function f1(callback) {\r\n  // ...\r\n  callback();\r\n}\r\n\r\nfunction f2() {\r\n  // ...\r\n}\r\n\r\nf1(f2);\n","language":"js","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-4bb509"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-3df832"},"children":[{"type":"text","value":"f1"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-565978"},"children":[{"type":"text","value":"callback"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-ca0565"},"children":[{"type":"text","value":"// ...\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-3df832"},"children":[{"type":"text","value":"callback"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-4bb509"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-3df832"},"children":[{"type":"text","value":"f2"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-ca0565"},"children":[{"type":"text","value":"// ...\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-3df832"},"children":[{"type":"text","value":"f1"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-565978"},"children":[{"type":"text","value":"f2"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":");"}]}]}]}]}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"优点"}]},{"type":"text","value":"：简单、容易理解和实现。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"缺点"}]},{"type":"text","value":"：不利于代码的阅读和维护，容易形成‘回调地狱’，各个部分之间高度耦合（coupling），使得程序结构混乱、流程难以追踪（尤其是多个回调函数嵌套的情况），而且每个任务只能指定一个回调函数。"}]}]},{"type":"element","tag":"h2","props":{"id":"_2事件监听"},"children":[{"type":"text","value":"2、事件监听"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"事件监听是采用事件驱动模式。异步任务的执行不取决于代码的顺序，而取决于某个事件是否发生。"}]},{"type":"element","tag":"code","props":{"code":"f1.on('done', f2);\r\n\r\nfunction f1() {\r\n  setTimeout(function () {\r\n    // ...\r\n    f1.trigger('done'); // 触发done事情\r\n  }, 1000);\r\n}\n","language":"js","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-565978"},"children":[{"type":"text","value":"f1"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-3df832"},"children":[{"type":"text","value":"on"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-2c5239"},"children":[{"type":"text","value":"'done'"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-565978"},"children":[{"type":"text","value":"f2"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-4bb509"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-3df832"},"children":[{"type":"text","value":"f1"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-3df832"},"children":[{"type":"text","value":"setTimeout"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-4bb509"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":" () {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-ca0565"},"children":[{"type":"text","value":"// ...\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-565978"},"children":[{"type":"text","value":"f1"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-3df832"},"children":[{"type":"text","value":"trigger"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-2c5239"},"children":[{"type":"text","value":"'done'"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"); "}]},{"type":"element","tag":"span","props":{"class":"ct-ca0565"},"children":[{"type":"text","value":"// 触发done事情\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"  }, "}]},{"type":"element","tag":"span","props":{"class":"ct-f729d8"},"children":[{"type":"text","value":"1000"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"上面代码使用JQuery编写， 首先，为 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"f1"}]},{"type":"text","value":"绑定一个事件，当 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"f1"}]},{"type":"text","value":"发生 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"done"}]},{"type":"text","value":"事件，就执行 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"f2"}]},{"type":"text","value":"，而 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"f1"}]},{"type":"text","value":"执行完成后，立即触发 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"done"}]},{"type":"text","value":"事件，从而开始执行 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"f2"}]},{"type":"text","value":"。"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"优点"}]},{"type":"text","value":"：比较容易理解，可以绑定多个事件，每个事件可以指定多个回调函数，而且可以\"去耦合\"（Decoupling），有利于实现模块化。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"缺点"}]},{"type":"text","value":"：整个程序都要变成事件驱动型，运行流程会变得很不清晰。"}]}]},{"type":"element","tag":"h2","props":{"id":"_3发布订阅"},"children":[{"type":"text","value":"3、发布/订阅"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"事件完全可以理解成 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"信号"}]},{"type":"text","value":"，如果存在一个 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"信号中心"}]},{"type":"text","value":"，某个任务执行完成，就向信号中心 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"发布"}]},{"type":"text","value":"一个信号，其他任务可以向信号中心 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"订阅"}]},{"type":"text","value":"这个信号，从而知道什么时候自己可以开始执行。这就叫做 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"发布/订阅模式"}]},{"type":"text","value":"，又称 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"观察者模式"}]},{"type":"text","value":"。"}]},{"type":"element","tag":"code","props":{"code":"// 订阅信号\r\njQuery.subscribe('done', f2);\r\n\r\nfunction f1() {\r\n  setTimeout(function () {\r\n    // ...\r\n    // 向信号中心jQuery发布done信号,从而引发f2的执行\r\n    jQuery.publish('done');\r\n  }, 1000);\r\n}\r\n\r\n// 取消订阅\r\njQuery.unsubscribe('done', f2);\n","language":"js","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-ca0565"},"children":[{"type":"text","value":"// 订阅信号\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-565978"},"children":[{"type":"text","value":"jQuery"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-3df832"},"children":[{"type":"text","value":"subscribe"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-2c5239"},"children":[{"type":"text","value":"'done'"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-565978"},"children":[{"type":"text","value":"f2"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-4bb509"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-3df832"},"children":[{"type":"text","value":"f1"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-3df832"},"children":[{"type":"text","value":"setTimeout"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-4bb509"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":" () {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-ca0565"},"children":[{"type":"text","value":"// ...\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-ca0565"},"children":[{"type":"text","value":"// 向信号中心jQuery发布done信号,从而引发f2的执行\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-565978"},"children":[{"type":"text","value":"jQuery"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-3df832"},"children":[{"type":"text","value":"publish"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-2c5239"},"children":[{"type":"text","value":"'done'"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"  }, "}]},{"type":"element","tag":"span","props":{"class":"ct-f729d8"},"children":[{"type":"text","value":"1000"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-ca0565"},"children":[{"type":"text","value":"// 取消订阅\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-565978"},"children":[{"type":"text","value":"jQuery"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-3df832"},"children":[{"type":"text","value":"unsubscribe"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-2c5239"},"children":[{"type":"text","value":"'done'"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-565978"},"children":[{"type":"text","value":"f2"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":");"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"上面代码使用JQuery编写，首先，"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"f2"}]},{"type":"text","value":"向信号中心 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"jQuery"}]},{"type":"text","value":"订阅 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"done"}]},{"type":"text","value":"信号。"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"f1"}]},{"type":"text","value":"执行完成后，向信号中心 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"jQuery"}]},{"type":"text","value":"发布 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"done"}]},{"type":"text","value":"信号，从而引发 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"f2"}]},{"type":"text","value":"的执行。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"这种方法的性质与 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"事件监听"}]},{"type":"text","value":"类似，但是明显优于后者。因为可以通过查看 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"消息中心"}]},{"type":"text","value":"，了解存在多少信号、每个信号有多少订阅者，从而监控程序的运行。"}]},{"type":"element","tag":"h2","props":{"id":"_4promise"},"children":[{"type":"text","value":"4、Promise"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Promise"}]},{"type":"text","value":" 实际就是一个对象， 从它可以获得异步操作的消息，"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Promise"}]},{"type":"text","value":" 对象有三种状态，"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"pending"}]},{"type":"text","value":"(进行中)、"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"fulfilled"}]},{"type":"text","value":"（已成功）和 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"rejected"}]},{"type":"text","value":"（已失败）。"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Promise"}]},{"type":"text","value":" 的状态一旦改变之后，就不会在发生任何变化,将回调函数变成了链式调用。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Promise"}]},{"type":"text","value":" 的设计思想是，每一个异步任务返回一个 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Promise"}]},{"type":"text","value":"对象，该对象有一个 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"then"}]},{"type":"text","value":"方法，用来指定下一步的回调函数。"}]},{"type":"element","tag":"code","props":{"code":"var p1 = new Promise(f1);\r\np1.then(f2);\n","language":"js","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-4bb509"},"children":[{"type":"text","value":"var"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-565978"},"children":[{"type":"text","value":"p1"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-4bb509"},"children":[{"type":"text","value":"new"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-d7a7da"},"children":[{"type":"text","value":"Promise"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-565978"},"children":[{"type":"text","value":"f1"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-565978"},"children":[{"type":"text","value":"p1"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-3df832"},"children":[{"type":"text","value":"then"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-565978"},"children":[{"type":"text","value":"f2"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":");"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"上面代码中，"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"f1"}]},{"type":"text","value":"的异步操作执行完成，就会执行 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"f2"}]},{"type":"text","value":"。"}]},{"type":"element","tag":"code","props":{"code":"function f1(){\r\n    var dfd = $.Deferred();\r\n    setTimeout(function () {\r\n        // f1的任务代码\r\n        dfd.resolve();\r\n    }, 500);\r\n    return dfd.promise;\r\n}\n","language":"js","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-4bb509"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-3df832"},"children":[{"type":"text","value":"f1"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"(){\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-4bb509"},"children":[{"type":"text","value":"var"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-565978"},"children":[{"type":"text","value":"dfd"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-565978"},"children":[{"type":"text","value":"$"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-3df832"},"children":[{"type":"text","value":"Deferred"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-3df832"},"children":[{"type":"text","value":"setTimeout"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-4bb509"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":" () {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-ca0565"},"children":[{"type":"text","value":"// f1的任务代码\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-565978"},"children":[{"type":"text","value":"dfd"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-3df832"},"children":[{"type":"text","value":"resolve"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"    }, "}]},{"type":"element","tag":"span","props":{"class":"ct-f729d8"},"children":[{"type":"text","value":"500"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-6c4a9a"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-565978"},"children":[{"type":"text","value":"dfd"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-565978"},"children":[{"type":"text","value":"promise"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"每次调用返回的都是一个新的Promise实例(then可用链式调用的原因)"}]},{"type":"element","tag":"code","props":{"code":"// 传统写法\r\nstep1(function (value1) {\r\n  step2(value1, function(value2) {\r\n    step3(value2, function(value3) {\r\n      step4(value3, function(value4) {\r\n        // ...\r\n      });\r\n    });\r\n  });\r\n});\r\n\r\n// Promise 的写法\r\n(new Promise(step1))\r\n  .then(step2)\r\n  .then(step3)\r\n  .then(step4);\n","language":"js","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-ca0565"},"children":[{"type":"text","value":"// 传统写法\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-3df832"},"children":[{"type":"text","value":"step1"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-4bb509"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-565978"},"children":[{"type":"text","value":"value1"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-3df832"},"children":[{"type":"text","value":"step2"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-565978"},"children":[{"type":"text","value":"value1"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-4bb509"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-565978"},"children":[{"type":"text","value":"value2"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-3df832"},"children":[{"type":"text","value":"step3"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-565978"},"children":[{"type":"text","value":"value2"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-4bb509"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-565978"},"children":[{"type":"text","value":"value3"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"      "}]},{"type":"element","tag":"span","props":{"class":"ct-3df832"},"children":[{"type":"text","value":"step4"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-565978"},"children":[{"type":"text","value":"value3"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-4bb509"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-565978"},"children":[{"type":"text","value":"value4"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-ca0565"},"children":[{"type":"text","value":"// ...\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"      });\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"    });\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"  });\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"});\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-ca0565"},"children":[{"type":"text","value":"// Promise 的写法\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-4bb509"},"children":[{"type":"text","value":"new"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-d7a7da"},"children":[{"type":"text","value":"Promise"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-565978"},"children":[{"type":"text","value":"step1"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"))\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"  ."}]},{"type":"element","tag":"span","props":{"class":"ct-3df832"},"children":[{"type":"text","value":"then"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-565978"},"children":[{"type":"text","value":"step2"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"  ."}]},{"type":"element","tag":"span","props":{"class":"ct-3df832"},"children":[{"type":"text","value":"then"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-565978"},"children":[{"type":"text","value":"step3"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"  ."}]},{"type":"element","tag":"span","props":{"class":"ct-3df832"},"children":[{"type":"text","value":"then"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-565978"},"children":[{"type":"text","value":"step4"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":");"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"传统的写法可能需要把 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"f2"}]},{"type":"text","value":"作为回调函数传入 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"f1"}]},{"type":"text","value":"，比如写成 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"f1(f2)"}]},{"type":"text","value":"，异步操作完成后，在 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"f1"}]},{"type":"text","value":"内部调用 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"f2"}]},{"type":"text","value":"。"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Promise"}]},{"type":"text","value":"使得 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"f1"}]},{"type":"text","value":"和 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"f2"}]},{"type":"text","value":"变成了链式写法。不仅改善了可读性，而且对于多层嵌套的回调函数尤其方便。"}]},{"type":"element","tag":"h2","props":{"id":"_5generator"},"children":[{"type":"text","value":"5、Generator"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Generator"}]},{"type":"text","value":" 函数是协程在 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"ES6"}]},{"type":"text","value":" 的实现，最大特点就是可以交出函数的执行权（即暂停执行）"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Generator"}]},{"type":"text","value":" 函数是一个状态机，封装了多个内部状态。执行 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Generator"}]},{"type":"text","value":" 函数会返回一个遍历器对象，使用该对象的 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"next()"}]},{"type":"text","value":" 方法，可以遍历 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Generator"}]},{"type":"text","value":" 函数内部的每一个状态，直到 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"return"}]},{"type":"text","value":" 语句。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Generator"}]},{"type":"text","value":" 函数的特征:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"function"}]},{"type":"text","value":" 关键字与函数名之间有一个星号"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"函数体内部使用 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"yield"}]},{"type":"text","value":" 表达式，"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"yield"}]},{"type":"text","value":" 是暂停执行的标记"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"next()"}]},{"type":"text","value":" 方法遇到 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"yield"}]},{"type":"text","value":" 表达式，就暂停执行后面的操作,并返回后面的值。"}]}]},{"type":"element","tag":"code","props":{"code":"function* gen(x){\r\n  var y = yield x + 2;\r\n  return y;\r\n}\r\n\r\nvar g = gen(1);\r\ng.next() // { value: 3, done: false }\r\ng.next(2) // { value: 2, done: true }\n","language":"js","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-4bb509"},"children":[{"type":"text","value":"function*"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-3df832"},"children":[{"type":"text","value":"gen"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-565978"},"children":[{"type":"text","value":"x"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"){\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-4bb509"},"children":[{"type":"text","value":"var"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-565978"},"children":[{"type":"text","value":"y"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-6c4a9a"},"children":[{"type":"text","value":"yield"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-565978"},"children":[{"type":"text","value":"x"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":" + "}]},{"type":"element","tag":"span","props":{"class":"ct-f729d8"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-6c4a9a"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-565978"},"children":[{"type":"text","value":"y"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-4bb509"},"children":[{"type":"text","value":"var"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-565978"},"children":[{"type":"text","value":"g"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-3df832"},"children":[{"type":"text","value":"gen"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-f729d8"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-565978"},"children":[{"type":"text","value":"g"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-3df832"},"children":[{"type":"text","value":"next"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"() "}]},{"type":"element","tag":"span","props":{"class":"ct-ca0565"},"children":[{"type":"text","value":"// { value: 3, done: false }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-565978"},"children":[{"type":"text","value":"g"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-3df832"},"children":[{"type":"text","value":"next"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-f729d8"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"class":"ct-ca0565"},"children":[{"type":"text","value":"// { value: 2, done: true }"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"上面代码中，第一个 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"next"}]},{"type":"text","value":" 方法的 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"value"}]},{"type":"text","value":" 属性，返回表达式 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"x + 2"}]},{"type":"text","value":" 的值 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"3"}]},{"type":"text","value":"。第二个 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"next"}]},{"type":"text","value":" 方法带有参数 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"2"}]},{"type":"text","value":"，这个参数可以传入 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Generator"}]},{"type":"text","value":" 函数，作为上个阶段异步任务的返回结果，被函数体内的变量 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"y"}]},{"type":"text","value":" 接收。因此，这一步的 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"value"}]},{"type":"text","value":" 属性，返回的就是 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"2"}]},{"type":"text","value":"（变量 y 的值）。"}]},{"type":"element","tag":"h2","props":{"id":"_6asyncawait"},"children":[{"type":"text","value":"6、async/await"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"async"}]},{"type":"text","value":" 函数就是 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Generator"}]},{"type":"text","value":" 函数的语法糖。"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"async"}]},{"type":"text","value":" 函数返回一个 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Promise"}]},{"type":"text","value":" 对象，可以使用 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"then"}]},{"type":"text","value":" 方法添加回调函数。当函数执行的时候，一旦遇到 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"await"}]},{"type":"text","value":" 就会先返回，等到触发的异步操作完成，再接着执行函数体内后面的语句。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"async/await"}]},{"type":"text","value":"的特征有："}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"async/await"}]},{"type":"text","value":"是基于 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Promise"}]},{"type":"text","value":"实现的，它不能用于普通的回调函数。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"async/await"}]},{"type":"text","value":"与 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Promise"}]},{"type":"text","value":"一样，是非阻塞的。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"async/await"}]},{"type":"text","value":"使得异步代码看起来像同步代码，这正是它的魔力所在。"}]}]},{"type":"element","tag":"code","props":{"code":"async function async1() {\r\n  return 2\r\n}\r\nconsole.log(async1()) // Promise {<resolved>: 2}\n","language":"js","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-4bb509"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-4bb509"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-3df832"},"children":[{"type":"text","value":"async1"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-6c4a9a"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-f729d8"},"children":[{"type":"text","value":"2\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-565978"},"children":[{"type":"text","value":"console"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-3df832"},"children":[{"type":"text","value":"log"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-3df832"},"children":[{"type":"text","value":"async1"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"()) "}]},{"type":"element","tag":"span","props":{"class":"ct-ca0565"},"children":[{"type":"text","value":"// Promise {<resolved>: 2}"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"上面代码中，函数前面加上 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"async"}]},{"type":"text","value":" 就会返回一个 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"promise"}]},{"type":"text","value":" 对象。"}]},{"type":"element","tag":"code","props":{"code":"const fs = require('fs');\r\n\r\nconst readFile = function (fileName) {\r\n  return new Promise(function (resolve, reject) {\r\n    fs.readFile(fileName, function(error, data) {\r\n      if (error) return reject(error);\r\n      resolve(data);\r\n    });\r\n  });\r\n};\r\n// Generator 函数写法\r\nconst gen = function* () {\r\n  const f1 = yield readFile('/etc/fstab');\r\n  const f2 = yield readFile('/etc/shells');\r\n  console.log(f1.toString());\r\n  console.log(f2.toString());\r\n};\r\n\r\n// aynsc 函数写法\r\nconst asyncReadFile = async function () {\r\n  const f1 = await readFile('/etc/fstab');\r\n  const f2 = await readFile('/etc/shells');\r\n  console.log(f1.toString());\r\n  console.log(f2.toString());\r\n};\n","language":"js","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-4bb509"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-14aa4b"},"children":[{"type":"text","value":"fs"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-3df832"},"children":[{"type":"text","value":"require"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-2c5239"},"children":[{"type":"text","value":"'fs'"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-4bb509"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-3df832"},"children":[{"type":"text","value":"readFile"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-4bb509"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-565978"},"children":[{"type":"text","value":"fileName"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-6c4a9a"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-4bb509"},"children":[{"type":"text","value":"new"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-d7a7da"},"children":[{"type":"text","value":"Promise"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-4bb509"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-565978"},"children":[{"type":"text","value":"resolve"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-565978"},"children":[{"type":"text","value":"reject"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-565978"},"children":[{"type":"text","value":"fs"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-3df832"},"children":[{"type":"text","value":"readFile"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-565978"},"children":[{"type":"text","value":"fileName"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-4bb509"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-565978"},"children":[{"type":"text","value":"error"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-565978"},"children":[{"type":"text","value":"data"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"      "}]},{"type":"element","tag":"span","props":{"class":"ct-6c4a9a"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-565978"},"children":[{"type":"text","value":"error"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"class":"ct-6c4a9a"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-3df832"},"children":[{"type":"text","value":"reject"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-565978"},"children":[{"type":"text","value":"error"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"      "}]},{"type":"element","tag":"span","props":{"class":"ct-3df832"},"children":[{"type":"text","value":"resolve"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-565978"},"children":[{"type":"text","value":"data"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"    });\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"  });\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"};\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-ca0565"},"children":[{"type":"text","value":"// Generator 函数写法\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-4bb509"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-3df832"},"children":[{"type":"text","value":"gen"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-4bb509"},"children":[{"type":"text","value":"function*"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":" () {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-4bb509"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-14aa4b"},"children":[{"type":"text","value":"f1"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-6c4a9a"},"children":[{"type":"text","value":"yield"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-3df832"},"children":[{"type":"text","value":"readFile"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-2c5239"},"children":[{"type":"text","value":"'/etc/fstab'"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-4bb509"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-14aa4b"},"children":[{"type":"text","value":"f2"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-6c4a9a"},"children":[{"type":"text","value":"yield"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-3df832"},"children":[{"type":"text","value":"readFile"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-2c5239"},"children":[{"type":"text","value":"'/etc/shells'"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-565978"},"children":[{"type":"text","value":"console"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-3df832"},"children":[{"type":"text","value":"log"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-565978"},"children":[{"type":"text","value":"f1"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-3df832"},"children":[{"type":"text","value":"toString"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"());\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-565978"},"children":[{"type":"text","value":"console"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-3df832"},"children":[{"type":"text","value":"log"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-565978"},"children":[{"type":"text","value":"f2"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-3df832"},"children":[{"type":"text","value":"toString"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"());\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"};\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"class":"ct-ca0565"},"children":[{"type":"text","value":"// aynsc 函数写法\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"class":"ct-4bb509"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-3df832"},"children":[{"type":"text","value":"asyncReadFile"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-4bb509"},"children":[{"type":"text","value":"async"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-4bb509"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":" () {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-4bb509"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-14aa4b"},"children":[{"type":"text","value":"f1"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-6c4a9a"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-3df832"},"children":[{"type":"text","value":"readFile"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-2c5239"},"children":[{"type":"text","value":"'/etc/fstab'"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-4bb509"},"children":[{"type":"text","value":"const"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-14aa4b"},"children":[{"type":"text","value":"f2"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-6c4a9a"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-3df832"},"children":[{"type":"text","value":"readFile"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-2c5239"},"children":[{"type":"text","value":"'/etc/shells'"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-565978"},"children":[{"type":"text","value":"console"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-3df832"},"children":[{"type":"text","value":"log"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-565978"},"children":[{"type":"text","value":"f1"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-3df832"},"children":[{"type":"text","value":"toString"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"());\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":24},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-565978"},"children":[{"type":"text","value":"console"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-3df832"},"children":[{"type":"text","value":"log"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-565978"},"children":[{"type":"text","value":"f2"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-3df832"},"children":[{"type":"text","value":"toString"}]},{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"());\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":25},"children":[{"type":"element","tag":"span","props":{"class":"ct-56eaea"},"children":[{"type":"text","value":"};"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"一比较就会发现，"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"async"}]},{"type":"text","value":"函数就是将 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Generator"}]},{"type":"text","value":"函数的星号 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"*"}]},{"type":"text","value":"替换成 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"async"}]},{"type":"text","value":"，将 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"yield"}]},{"type":"text","value":"替换成 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"await"}]},{"type":"text","value":"，仅此而已。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"优点"}]},{"type":"text","value":"：更好的语义,更广的适用性,返回值是 Promise。"}]},{"type":"element","tag":"h2","props":{"id":"总结"},"children":[{"type":"text","value":"总结"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"JS 异步编程发展史："},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"callback"}]},{"type":"text","value":" -> "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"promise"}]},{"type":"text","value":" -> "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"generator"}]},{"type":"text","value":" -> "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"async + await"}]},{"type":"text","value":"。"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"async/await"}]},{"type":"text","value":"函数的实现是将 "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Generator"}]},{"type":"text","value":"函数和自动执行器，包装在一个函数里。它也是目前异步最好的解决方案了。"}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-14aa4b{color:#4FC1FF}\n.ct-6c4a9a{color:#C586C0}\n.ct-d7a7da{color:#4EC9B0}\n.ct-f729d8{color:#B5CEA8}\n.ct-2c5239{color:#CE9178}\n.ct-ca0565{color:#6A9955}\n.ct-565978{color:#9CDCFE}\n.ct-3df832{color:#DCDCAA}\n.ct-56eaea{color:#D4D4D4}\n.ct-4bb509{color:#569CD6}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"异步编程解决了什么问题","depth":2,"text":"异步编程解决了什么问题？"},{"id":"同步和异步任务","depth":2,"text":"同步和异步任务"},{"id":"_1回调函数","depth":2,"text":"1、回调函数"},{"id":"_2事件监听","depth":2,"text":"2、事件监听"},{"id":"_3发布订阅","depth":2,"text":"3、发布/订阅"},{"id":"_4promise","depth":2,"text":"4、Promise"},{"id":"_5generator","depth":2,"text":"5、Generator"},{"id":"_6asyncawait","depth":2,"text":"6、async/await"},{"id":"总结","depth":2,"text":"总结"}]}},"_type":"markdown","_id":"content:articles:2020-04-01-Js异步编程方案总结.md","_source":"content","_file":"articles/2020-04-01-Js异步编程方案总结.md","_extension":"md"},{"_path":"/articles/2020-05-02-cssz-indexopacity","_dir":"articles","_draft":false,"_partial":false,"_locale":"","_empty":false,"title":"CSS中z-index属性在使用opacity后失效","description":"本篇博客主要是对 CSS 中 z-index 属性在使用 opacity 后失效","excerpt":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"本篇博客主要是对 CSS 中 z-index 属性在使用 opacity 后失效"}]}]},"date":"2020-05-01T00:00:00.000Z","tags":["css"],"body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"本篇博客主要是对 CSS 中 z-index 属性在使用 opacity 后失效"}]},{"type":"element","tag":"h2","props":{"id":"背景"},"children":[{"type":"text","value":"背景"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"当父盒子背景需要修改透明度 和 子盒子使用 z-index 提高层级的时候，会出现以下情况,会被阻挡"}]},{"type":"element","tag":"h2","props":{"id":"原因"},"children":[{"type":"text","value":"原因"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"父盒子的 opacity 会导致 子盒子在使用 z-index 的失效"}]},{"type":"element","tag":"h2","props":{"id":"解决办法"},"children":[{"type":"text","value":"解决办法"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"比如 父盒子背景需要设置颜色为白色， opacity 为 0.8 的时候，可以将背景颜色修改为 rgba 写法 通过第四个值，alpha 值，制定了色彩的透明度/不透明度，它的范围为 0.0 到 1.0 之间,0.5 为半透明。可以解决子元素 z-index 失效，这样就能避免使用 opacity."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"背景","depth":2,"text":"背景"},{"id":"原因","depth":2,"text":"原因"},{"id":"解决办法","depth":2,"text":"解决办法"}]}},"_type":"markdown","_id":"content:articles:2020-05-02-CSS中z-index属性在使用opacity后失效.md","_source":"content","_file":"articles/2020-05-02-CSS中z-index属性在使用opacity后失效.md","_extension":"md"},{"_path":"/articles/2020-05-02-js","_dir":"articles","_draft":false,"_partial":false,"_locale":"","_empty":false,"title":"深入 JS 之作用域和闭包","description":"本篇博客主要是对 Javcscript 作用域和闭包学习理解","excerpt":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"本篇博客主要是对 Javcscript 作用域和闭包学习理解"}]}]},"date":"2020-05-01T00:00:00.000Z","tags":["Closure","JavaScript"],"body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"本篇博客主要是对 Javcscript 作用域和闭包学习理解"}]},{"type":"element","tag":"h2","props":{"id":"作用域"},"children":[{"type":"text","value":"作用域"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"编译原理对作用域的定义："}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"作用域是指声明的变量在程序中的一个区域，在其中对变量的使用都指向这个声明。如果仅通过阅读程序就可以确定一个变量的作用域，那么语言使用的是词法作用域，否则，这个语言使用的是动态作用域。"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"作用域用一句话概括就是规定如何查找变量，检查是否对变量有访问权限。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"JavaScript 采用词法作用域，也叫静态作用域。"}]},{"type":"element","tag":"h2","props":{"id":"编译"},"children":[{"type":"text","value":"编译"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"MDN 对 JavaScript 的定义为："}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"JavaScript 是一种解释型或即时编译型的编程语言。"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"JavaScript 语言是解释型语言，解释型语言的特点是逐个语句地执行源程序，会出现性能低下问题。而谷歌团队为解决 web 前端工作者的 JavaScript 性能低下问题，首次在脚本引擎（V8）中使用的即时编译（JIT），加上使用隐藏类和内联缓存等方法，使 JavaScript 语言拥有堪比主流编程语言（Java）的执行速度。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"思考下面 🌰 ："}]},{"type":"element","tag":"code","props":{"code":"var greeting = \"Hello\";\r\n\r\nconsole.log(greeting);\r\n\r\nvar greeting = .\"Hello\";\r\n\r\n// SyntaxError: Unexpected token '.'\n","language":"js","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-c42d0a"},"children":[{"type":"text","value":"var"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e43f92"},"children":[{"type":"text","value":"greeting"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-8bd768"},"children":[{"type":"text","value":"\"Hello\""}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-e43f92"},"children":[{"type":"text","value":"console"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-43df80"},"children":[{"type":"text","value":"log"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-e43f92"},"children":[{"type":"text","value":"greeting"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-c42d0a"},"children":[{"type":"text","value":"var"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e43f92"},"children":[{"type":"text","value":"greeting"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":" = ."}]},{"type":"element","tag":"span","props":{"class":"ct-8bd768"},"children":[{"type":"text","value":"\"Hello\""}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-b1851e"},"children":[{"type":"text","value":"// SyntaxError: Unexpected token '.'"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"首先，根据解释型语言的定义，代码会在执行时被编译且逐行执行。上面代码执行结果应是先输出变量，接着赋值报错。但是实际结果是直接报错。是由于执行程序的前一刻会进行编译。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"JavaScript 脚本引擎的工作方式来进一步理解上面的 🌰："}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"脚本引擎要开始解释执行，得通过词法分析和语法分析得到语法分析树后才可以。当要执行 script 代码段，它的执行顺序如下："}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"读入代码。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"做词法分析和语法分析，有错则报语法错误。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"对 var 变量和 function 定义做“预解析”。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"执行代码，有错则报错。"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"最后，我们可以清楚的明白，代码在程序执行的前一刻在编译做语法分析的时候，遇到语法错误所以直接报错，区别与传统的解释型语言，JavaScript 是解析器和编译器混合使用。程序最后其实并没有执行。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"上面过程，可以将 JavaScript 引擎工作方式归结两个阶段：解析和执行。"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"解析：通过语法分析和预解析构造合法的语法分析树。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"执行：执行具体的某个 function， JavaScript 引擎在执行每个函数实例时， 都会创建一个执行环境 (Execution Context) 和活动对象 (Active Object) 。"}]}]},{"type":"element","tag":"h2","props":{"id":"词法作用域"},"children":[{"type":"text","value":"词法作用域"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"要真正理解首先要先了解几个比较重要的概念。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"词法作用域定义："}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"词法作用域指变量的作用域不是执行时决定而是在定义时决定，也就是说通过静态分析就能确定，词法作用域取决于源码，因此词法作用域也叫做静态作用域。"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"ES5中使用词法环境管理词法作用域。ES6中作用域的概念变成了词法环境概念。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"编译原理对环境和状态的定义："}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"环境指的是名字到变量的映射（内存位置）。状态是内存位置到它们值的映射。"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"词法环境的定义："}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"词法环境 是一个用于定义特定变量和函数标识符在 ECMAScript 代码的词法嵌套结构上关联关系的规范类型。简单来说是 JavaScript 引擎内部用来跟踪标识符和变量之间的映射关系。"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"词法环境由一个环境记录项和可能为空的外部词法环境引用构成。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"变量环境组件和词法环境，又统称为词法环境。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"变量环境的定义："}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"变量标识符和函数标识符对内存位置的映射，简单来说声明的变量函数它们知道自己的数据存储在哪里。（等同于词法环境）"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"执行环境（也称执行上下文）的定义："}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"执行环境就是当前 JavaScript 代码被解析和执行时所在环境的抽象概念， JavaScript 中运行任何的代码都是在执行环境中运行。"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"每调用一个函数就会生成一个函数执行环境，script 标签里的代码可以看成是一个立即执行的“匿名函数”，这个被称为全局执行环境。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"ES5 执行环境组成部分："}]},{"type":"element","tag":"code","props":{"code":"ExecutionContext = {\r\n  ThisBinding: <this value>,\r\n  VariableEnvironment: { ... }, // 变量环境\r\n  LexicalEnvironment: { ... }   // 词法环境\r\n}\n","language":"js","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-e43f92"},"children":[{"type":"text","value":"ExecutionContext"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":" = {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-e43f92"},"children":[{"type":"text","value":"ThisBinding:"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-053ab1"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-c42d0a"},"children":[{"type":"text","value":"this"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e43f92"},"children":[{"type":"text","value":"value"}]},{"type":"element","tag":"span","props":{"class":"ct-053ab1"},"children":[{"type":"text","value":">"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"  VariableEnvironment: "}]},{"type":"element","tag":"span","props":{"class":"ct-c42d0a"},"children":[{"type":"text","value":"{"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":" ... "}]},{"type":"element","tag":"span","props":{"class":"ct-c42d0a"},"children":[{"type":"text","value":"}"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":", // 变量环境\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"  LexicalEnvironment: "}]},{"type":"element","tag":"span","props":{"class":"ct-c42d0a"},"children":[{"type":"text","value":"{"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":" ... "}]},{"type":"element","tag":"span","props":{"class":"ct-c42d0a"},"children":[{"type":"text","value":"}"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"   // 词法环境\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"进一步理解，来看下面 🌰："}]},{"type":"element","tag":"code","props":{"code":"// __outer__：外部词法环境引用，x、y：环境记录项。\r\n// 全局环境变量 VariableEnvironment (global) = { __outer__: null }\r\n// 词法环境 LexicalEnvironment = VariableEnvironment (global)\r\n\r\n// 立即执行函数foo\r\n(function foo() {\r\n  //1、 这里命名为A（随便取用于区分下面） 的变量环境\r\n  //（可以理解为执行之前分配内存空间，初始化为undefined）\r\n  // VariableEnvironment (A) = { x: undefined, __outer__: global } \r\n  \r\n  //2、 词法环境等同于变量环境的原因，变量环境是词法环境的引用\r\n  // LexicalEnvironment = VariableEnvironment (A) \r\n\r\n  var x;\r\n  // 立即执行函数bar\r\n  (function bar(){\r\n    // 初始化词法环境\r\n    // VariableEnvironment (B) = { y: undefined, __outer__: A }\r\n    // LexicalEnvironment = VariableEnvironment (B)\r\n\r\n    var y;\r\n\r\n    x = 2;\r\n    // 初始化词法环境完成之后，立即执行 x=2 语句，通过__outer__找到外部的x\r\n    // VariableEnvironment (A) = { x: 2, __outer__: global }\r\n    // bar LexicalEnvironment 仍然是 VariableEnvironment (B)\r\n\r\n  })();\r\n\r\n})();\n","language":"js","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-b1851e"},"children":[{"type":"text","value":"// __outer__：外部词法环境引用，x、y：环境记录项。\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-b1851e"},"children":[{"type":"text","value":"// 全局环境变量 VariableEnvironment (global) = { __outer__: null }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-b1851e"},"children":[{"type":"text","value":"// 词法环境 LexicalEnvironment = VariableEnvironment (global)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-b1851e"},"children":[{"type":"text","value":"// 立即执行函数foo\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-c42d0a"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-43df80"},"children":[{"type":"text","value":"foo"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-b1851e"},"children":[{"type":"text","value":"//1、 这里命名为A（随便取用于区分下面） 的变量环境\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-b1851e"},"children":[{"type":"text","value":"//（可以理解为执行之前分配内存空间，初始化为undefined）\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-b1851e"},"children":[{"type":"text","value":"// VariableEnvironment (A) = { x: undefined, __outer__: global } \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"  \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-b1851e"},"children":[{"type":"text","value":"//2、 词法环境等同于变量环境的原因，变量环境是词法环境的引用\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-b1851e"},"children":[{"type":"text","value":"// LexicalEnvironment = VariableEnvironment (A) \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-c42d0a"},"children":[{"type":"text","value":"var"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e43f92"},"children":[{"type":"text","value":"x"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-b1851e"},"children":[{"type":"text","value":"// 立即执行函数bar\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"  ("}]},{"type":"element","tag":"span","props":{"class":"ct-c42d0a"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-43df80"},"children":[{"type":"text","value":"bar"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"(){\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-b1851e"},"children":[{"type":"text","value":"// 初始化词法环境\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-b1851e"},"children":[{"type":"text","value":"// VariableEnvironment (B) = { y: undefined, __outer__: A }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-b1851e"},"children":[{"type":"text","value":"// LexicalEnvironment = VariableEnvironment (B)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-c42d0a"},"children":[{"type":"text","value":"var"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e43f92"},"children":[{"type":"text","value":"y"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-e43f92"},"children":[{"type":"text","value":"x"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-4d4437"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":24},"children":[{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-b1851e"},"children":[{"type":"text","value":"// 初始化词法环境完成之后，立即执行 x=2 语句，通过__outer__找到外部的x\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":25},"children":[{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-b1851e"},"children":[{"type":"text","value":"// VariableEnvironment (A) = { x: 2, __outer__: global }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":26},"children":[{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-b1851e"},"children":[{"type":"text","value":"// bar LexicalEnvironment 仍然是 VariableEnvironment (B)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":27},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":28},"children":[{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"  })();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":29},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":30},"children":[{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"})();"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"创建执行环境时，变量环境和词法环境最初是同一个值（变量环境指向词法环境），在执行环境执行相关代码过程中，变量环境组件永远不变，而词法环境组件有可能改变（with、eval可以改变词法环境），在函数即将执行前，会对var和function声明进行预解析，然后执行代码。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"再看一个 🌰："}]},{"type":"element","tag":"code","props":{"code":"var x = 10; // 语句会拆成两个阶段，预解析var x；执行代码 x = 10；\r\n\r\nfunction foo() {\r\n  var y = 20;\r\n console.log(x + y); // 30\r\n}\r\n\r\n// 词法环境由一个环境记录项（environmentRecord）和可能为空的\r\n// 外部词法环境 （outer environment）引用构成。\r\n\r\n// 执行环境执行之前的结果（创建函数阶段）\r\nVariableEnvironment (global) = {\r\n  environmentRecord: {\r\n    // 分配内存默认为undefined；\r\n    x: undefined\r\n  },\r\n  outer: null // 没有外部环境\r\n};\r\n\r\n//  \"foo\" 函数变量环境\r\nVariableEnvironment (foo) = {\r\n  environmentRecord: {\r\n    y: undefined\r\n  },\r\n  outer: globalEnvironment // 指向全局环境\r\n};\r\n\r\n\r\n// 全局作用域下的环境执行之后的结果\r\nVariableEnvironment (global) = {\r\n  environmentRecord: {\r\n    // 绑定的值\r\n    x: 10\r\n  },\r\n  outer: null // 没有外部环境\r\n};\r\n\r\n//  \"foo\" 函数环境\r\nVariableEnvironment (foo) = {\r\n  environmentRecord: {\r\n    y: 20\r\n  },\r\n  outer: globalEnvironment // 指向全局环境\r\n};\n","language":"js","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-c42d0a"},"children":[{"type":"text","value":"var"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e43f92"},"children":[{"type":"text","value":"x"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-4d4437"},"children":[{"type":"text","value":"10"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"; "}]},{"type":"element","tag":"span","props":{"class":"ct-b1851e"},"children":[{"type":"text","value":"// 语句会拆成两个阶段，预解析var x；执行代码 x = 10；\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-c42d0a"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-43df80"},"children":[{"type":"text","value":"foo"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-c42d0a"},"children":[{"type":"text","value":"var"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e43f92"},"children":[{"type":"text","value":"y"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-4d4437"},"children":[{"type":"text","value":"20"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":";\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e43f92"},"children":[{"type":"text","value":"console"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-43df80"},"children":[{"type":"text","value":"log"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-e43f92"},"children":[{"type":"text","value":"x"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":" + "}]},{"type":"element","tag":"span","props":{"class":"ct-e43f92"},"children":[{"type":"text","value":"y"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"); "}]},{"type":"element","tag":"span","props":{"class":"ct-b1851e"},"children":[{"type":"text","value":"// 30\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-b1851e"},"children":[{"type":"text","value":"// 词法环境由一个环境记录项（environmentRecord）和可能为空的\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-b1851e"},"children":[{"type":"text","value":"// 外部词法环境 （outer environment）引用构成。\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-b1851e"},"children":[{"type":"text","value":"// 执行环境执行之前的结果（创建函数阶段）\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-43df80"},"children":[{"type":"text","value":"VariableEnvironment"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-e43f92"},"children":[{"type":"text","value":"global"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":") = {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-e43f92"},"children":[{"type":"text","value":"environmentRecord:"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-b1851e"},"children":[{"type":"text","value":"// 分配内存默认为undefined；\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-e43f92"},"children":[{"type":"text","value":"x:"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-c42d0a"},"children":[{"type":"text","value":"undefined\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"  },\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-e43f92"},"children":[{"type":"text","value":"outer:"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-c42d0a"},"children":[{"type":"text","value":"null"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-b1851e"},"children":[{"type":"text","value":"// 没有外部环境\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"};\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"class":"ct-b1851e"},"children":[{"type":"text","value":"//  \"foo\" 函数变量环境\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"class":"ct-43df80"},"children":[{"type":"text","value":"VariableEnvironment"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-e43f92"},"children":[{"type":"text","value":"foo"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":") = {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-e43f92"},"children":[{"type":"text","value":"environmentRecord:"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-e43f92"},"children":[{"type":"text","value":"y:"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-c42d0a"},"children":[{"type":"text","value":"undefined\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":24},"children":[{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"  },\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":25},"children":[{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-e43f92"},"children":[{"type":"text","value":"outer:"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e43f92"},"children":[{"type":"text","value":"globalEnvironment"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-b1851e"},"children":[{"type":"text","value":"// 指向全局环境\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":26},"children":[{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"};\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":27},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":28},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":29},"children":[{"type":"element","tag":"span","props":{"class":"ct-b1851e"},"children":[{"type":"text","value":"// 全局作用域下的环境执行之后的结果\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":30},"children":[{"type":"element","tag":"span","props":{"class":"ct-43df80"},"children":[{"type":"text","value":"VariableEnvironment"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-e43f92"},"children":[{"type":"text","value":"global"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":") = {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":31},"children":[{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-e43f92"},"children":[{"type":"text","value":"environmentRecord:"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":32},"children":[{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-b1851e"},"children":[{"type":"text","value":"// 绑定的值\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":33},"children":[{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-e43f92"},"children":[{"type":"text","value":"x:"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-4d4437"},"children":[{"type":"text","value":"10\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":34},"children":[{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"  },\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":35},"children":[{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-e43f92"},"children":[{"type":"text","value":"outer:"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-c42d0a"},"children":[{"type":"text","value":"null"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-b1851e"},"children":[{"type":"text","value":"// 没有外部环境\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":36},"children":[{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"};\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":37},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":38},"children":[{"type":"element","tag":"span","props":{"class":"ct-b1851e"},"children":[{"type":"text","value":"//  \"foo\" 函数环境\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":39},"children":[{"type":"element","tag":"span","props":{"class":"ct-43df80"},"children":[{"type":"text","value":"VariableEnvironment"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-e43f92"},"children":[{"type":"text","value":"foo"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":") = {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":40},"children":[{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-e43f92"},"children":[{"type":"text","value":"environmentRecord:"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":41},"children":[{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-e43f92"},"children":[{"type":"text","value":"y:"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-4d4437"},"children":[{"type":"text","value":"20\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":42},"children":[{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"  },\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":43},"children":[{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-e43f92"},"children":[{"type":"text","value":"outer:"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e43f92"},"children":[{"type":"text","value":"globalEnvironment"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-b1851e"},"children":[{"type":"text","value":"// 指向全局环境\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":44},"children":[{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"};"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"执行结果流程图："}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"","src":"https://user-gold-cdn.xitu.io/2020/4/16/1717ea3374f17dff?w=452&h=333&f=png&s=40934"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"通过上面个栗子，无论何时调用函数都会创建一个新的执行环境，被推入执行上下文栈，此外还会创建与之关联的词法环境和变量环境。新建的词法环境通过外部环境引用进行关联。在执行代码之前，词法环境会访问并注册在当前词法作用域中所声明的变量，词法环境通过变量环境跟踪变量的作用域。特别注意是对 var 声明的变量和 function 声明函数！！！"}]},{"type":"element","tag":"code","props":{"code":"console.log(a);\r\n// Cannot access 'a' before initialization\r\n\r\nlet a = 1\r\n\r\nconsole.log(b)\r\n// undefined\r\n\r\nvar b = function() {\r\n    console.log(\"我调用了个函数\")\r\n}\n","language":"js","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-e43f92"},"children":[{"type":"text","value":"console"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-43df80"},"children":[{"type":"text","value":"log"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-e43f92"},"children":[{"type":"text","value":"a"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":");\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-b1851e"},"children":[{"type":"text","value":"// Cannot access 'a' before initialization\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-c42d0a"},"children":[{"type":"text","value":"let"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-e43f92"},"children":[{"type":"text","value":"a"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-4d4437"},"children":[{"type":"text","value":"1\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-e43f92"},"children":[{"type":"text","value":"console"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-43df80"},"children":[{"type":"text","value":"log"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-e43f92"},"children":[{"type":"text","value":"b"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-b1851e"},"children":[{"type":"text","value":"// undefined\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-c42d0a"},"children":[{"type":"text","value":"var"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-43df80"},"children":[{"type":"text","value":"b"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":" = "}]},{"type":"element","tag":"span","props":{"class":"ct-c42d0a"},"children":[{"type":"text","value":"function"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"() {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-e43f92"},"children":[{"type":"text","value":"console"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"."}]},{"type":"element","tag":"span","props":{"class":"ct-43df80"},"children":[{"type":"text","value":"log"}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-8bd768"},"children":[{"type":"text","value":"\"我调用了个函数\""}]},{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-3909c3"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"闭包"},"children":[{"type":"text","value":"闭包"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"MDN 中对闭包的定义："}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"函数和对其周围状态（词法环境）的引用捆绑在一起构成闭包。"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"面试官问什么是闭包？"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"我想大部分小伙伴都是闭包就是能够读取其他函数内部变量的函数。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"说实话没深入研究之前，我也是背背表面概念（毕竟网上一大堆都是这样说的）。通过对上面词法作用域的理解以后，我们突然会觉得上面的 MDN 定义太准确了。仔细分析就是外函数里面嵌套一个内函数并返回内函数，但调用内函数的时候，会创建词法环境，外部环境引用（上文的outer）指向外函数词法环境，直到全局词法环境执行指向 null。即使外函数词法环境已经消失，但还是可以通过内函数的词法环境外部环境指向访问到，这就是闭包。调用 N 次内函数，就会创建 N 个词法环境和 N 个闭包。"}]},{"type":"element","tag":"h2","props":{"id":"写在最后"},"children":[{"type":"text","value":"写在最后"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"用心写篇文章不易，如果内容中有不妥的地方欢迎指正，当然博客只是学习参考的依据，真正要学到掌握还是需要自己下功夫和研究的。毕竟别人的理解并不一定是自己的理解。如果对你有所帮助欢迎点赞收藏，码字不易，大家加油！！！"}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-4d4437{color:#B5CEA8}\n.ct-053ab1{color:#808080}\n.ct-b1851e{color:#6A9955}\n.ct-43df80{color:#DCDCAA}\n.ct-8bd768{color:#CE9178}\n.ct-e43f92{color:#9CDCFE}\n.ct-3909c3{color:#D4D4D4}\n.ct-c42d0a{color:#569CD6}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"作用域","depth":2,"text":"作用域"},{"id":"编译","depth":2,"text":"编译"},{"id":"词法作用域","depth":2,"text":"词法作用域"},{"id":"闭包","depth":2,"text":"闭包"},{"id":"写在最后","depth":2,"text":"写在最后"}]}},"_type":"markdown","_id":"content:articles:2020-05-02-深入Js之我是如何搞懂作用域和闭包的.md","_source":"content","_file":"articles/2020-05-02-深入Js之我是如何搞懂作用域和闭包的.md","_extension":"md"}]